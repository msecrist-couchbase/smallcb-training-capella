# Copy init-couchbase files into image.

RUN mkdir -p /init-couchbase
COPY init-couchbase /init-couchbase
RUN chmod +x /init-couchbase/*.sh

# Copy play-server's run-*.sh files into image.

COPY cmd/play-server/run-*.sh /
RUN chmod +x /run-*.sh

# Create the play user for user-submitted playground code.

RUN useradd -u 1001 -g couchbase -m play

# The npm install seems to need a non-root user, so use the play user.

USER play

RUN echo "prefix = /home/play/npm_packages" >> ~/.npmrc && \
    PATH=/home/play/npm-packages/bin:$PATH \
    NODE_PATH=/home/play/npm-packages/lib/node_modules:$NODE_PATH \
    NPM_PACKAGES=/home/play/npm-packages \
    npm install -g couchbase ottoman

USER root
