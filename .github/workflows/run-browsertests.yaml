name: Playground brower selenium CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8]

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
    - name: Install Google Chrome
      run: |
        wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo apt -qq install ./google-chrome-stable_current_amd64.deb
        google-chrome-stable --version
    - name: Run selenium tests
      run: |
        cd tests
        pip install -r requirements.txt
        LOG_FILE=tests_run_log.txt
        DRIVER_OPTIONS='-headless' python cblive_playground_browsertest.py | tee ${LOG_FILE}
        chmod a+x ./send_pg_health.sh
        echo ${GITHUB_ACTION} ${{GITHUB_JOB}} ${GITHUB_RUN_ID}
        ./send_pg_health.sh ${{ SLACK_WEBHOOK_URL_TEST }} ${GITHUB_ACTION} ${LOG_FILE}
        
