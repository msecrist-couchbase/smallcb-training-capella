title: Connect Multiple Locations with Data Streaming

containers: 2

panels:
 -
  id: w-cluster
  title: west cluster
  title-more: "username: ${s[0].CBUser} &nbsp;&nbsp; password: ${s[0].CBPswd}"
  color: "#8762a0;"
  iframe-src: http://${document.location.hostname}:${s[0].ContainerPortBase}/ui/index.html?lu=${s[0].CBUser}&lp=${s[0].CBPswd}
 -
  id: e-cluster
  title: east cluster
  title-more: "username: ${s[1].CBUser} &nbsp;&nbsp; password: ${s[1].CBPswd}"
  color: "#87d642"
  iframe-src: http://${document.location.hostname}:${s[1].ContainerPortBase}/ui/index.html?lu=${s[1].CBUser}&lp=${s[1].CBPswd}

diagram:
 height: 50px
 content: |
  <div class="diagram-more"
       style="position: absolute; display: none; opacity: 0.3; user-select: none;">
    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 60px; transform: rotateZ(50deg);"></div>
    <div style="position: absolute; top: 80px; left: 60px;">
      <img src="./img/db-purple.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">warehouse-w01 cluster</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 80px; transform: rotateZ(75deg);"></div>
    <div style="position: absolute; top: 110px; left: 40px;">
      <img src="./img/db-purple.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-w02 cluster</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 105px; transform: rotateZ(88deg);"></div>
    <div style="position: absolute; top: 140px; left: 20px;">
      <img src="./img/db-purple.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">vehicle-17 db</div>
    </div>
  </div>

  <div class="diagram-more"
       style="position: absolute; display: none; opacity: 0.3; user-select: none; left: 250px;">
    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 60px; transform: rotateZ(50deg);"></div>
    <div style="position: absolute; top: 80px; left: 60px;">
      <img src="./img/db-green.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-e07 cluster</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 80px; transform: rotateZ(75deg);"></div>
    <div style="position: absolute; top: 110px; left: 40px;">
      <img src="./img/db-green.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-e09 cluster</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 105px; transform: rotateZ(88deg);"></div>
    <div style="position: absolute; top: 140px; left: 20px;">
      <img src="./img/db-green.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-e15 cluster</div>
    </div>
  </div>

  <div class="diagram-more west-east-stream"
       style="display: none; position: absolute; top: 27px; left: 205px; height: 6px; width: 44px;"></div>

  <style>
    .west-east-stream {
      background: linear-gradient(-90deg, #4287D6, white);
      background-repeat: repeat-x;
      background-size: 15px 6px;
      animation: west-east-stream 4s infinite linear;
    }
    @keyframes west-east-stream {
      0% {
        background-position: 0px 0px;
      }
      100% {
        background-position: 44px 0px;
      }
    }
  </style>

  <label for="w-cluster"
         class="title background-color-white"
         style="top: 10px; width: 12em; height: 35px;">
    <img src="./img/db-purple.svg"
         style="top: 0px; left: 0px; width: 50px;"/>
    <div style="top: 3px; left: 50px;">
      west cluster
      <div class="small">${s[0].ContainerIP}</div>
    </div>
  </label>

  <label for="e-cluster"
         class="title background-color-white"
         style="top: 10px; left: 250px; width: 12em; height: 35px;">
    <img src="./img/db-green.svg"
         style="top: 0px; left: 0px; width: 50px;"/>
    <div style="top: 3px; left: 50px;">
      east cluster
      <div class="small">${s[1].ContainerIP}</div>
    </div>
  </label>

steps:
 -
  title: Welcome
  content: |
   Mission-critical enterprise applications
   are often distributed across
   <span class="nowrap">multiple locations</span>
   and clouds and are connected by
   <b>data&nbsp;streams</b>.
   <br/><br/>

   <style>
     body .container main.step-0 .right .diagram-area {
       min-height: 200px;
     }
     body .container main.step-0 .right .diagram-area .diagram-more {
       display: block !important;
     }
   </style>

   In this tour, we'll create a data stream
   between two Couchbase database clusters:
   <br/>
   <ul>
    <li>a <img src="./img/db-purple.svg" style="height: 1rem; position: relative; top: 3px;"/>
        <code>west</code> cluster<br/></li>
    <li>a <img src="./img/db-green.svg" style="height: 1rem; position: relative; top: 3px;"/>
        <code>east</code> cluster<br/></li>
   </ul>

   <b>Click</b> on their diagram icons
   on the right to open their web-admin UI's.
 -
  title: A new bucket in the east
  panel: e-cluster
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
   checks:
    - q('form input[ng-model="bucketConf.name"]').value == '' && (qLast.value = 'my-first-bucket') && qLast.dispatchEvent && qLast.dispatchEvent(new InputEvent("input")) && false
  content: |
   Let's start by creating a new, empty bucket
   <aside style="display: inline;">(or data container)</aside>
   in the
   <img src="./img/db-green.svg" style="height: 0.7rem; position: relative; top: 1px;"/>
   <code>east</code> cluster.
   <br/><br/>

   In the <code>east</code> web-admin UI...
   <br/><br/>

   Click on <b>ADD&nbsp;BUCKET</b> and fill in...
   <br/>

   <ul>
   <li>
    <b>Name</b>:
    <br/>
    <code class="nowrap">my-first-bucket</code>
   </li>
   </ul>

   Click the <b>Add&nbsp;Bucket</b> button.
 -
  title: Buckets in the east
  panel: e-cluster
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   You should now see three buckets in the
   <img src="./img/db-green.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>
   <code>east</code> cluster:
   <br/>

   <ul>
    <li><code>beer-sample</code></li>
    <li><b><code>my-first-bucket</code></b></li>
    <li><code>travel-sample</code></li>
   </ul>

   You can see that your new
   <code class="nowrap">my-first-bucket</code>
   is <b>empty</b> with 0 items.
   <br/><br/>

   Next, let's examine the <code>west</code> cluster.
 -
  title: Buckets in the west
  panel: w-cluster
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   In the
   <img src="./img/db-purple.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>
   <code>west</code> cluster,
   there are only two buckets:
   <br/>

   <ul>
    <li><b><code>beer-sample</code></b></li>
    <li><code>travel-sample</code></li>
   </ul>

   We are going to create a data stream...
   <br/><br/>

   ...that will send data from the
   <code class"nowrap">beer-sample</code>
   bucket from the 
   <img src="./img/db-purple.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>
   west side...
   <br/><br/>

   ...over into the
   <code class="nowrap">my-first-bucket</code>
   <br/>
   on the
   <img src="./img/db-green.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>east.
 -
  title: Connect the clusters
  panel: w-cluster
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=replications]"
   checks:
    - "(q('header h1 > span:last-child').innerText || '').trim() == 'XDCR Replications' && 'xdcr'"
    - "q('input#cluster_reference_name').value == '' && (qLast.value = 'east') && qLast.dispatchEvent && qLast.dispatchEvent(new InputEvent('input')) && false"
    - "q('input#cluster_reference_name').value == 'east' && 'cluster-name'"
    - "q('input#cluster_reference_hostname').value == '' && (qLast.value = '${s[1].ContainerIP}') && qLast.dispatchEvent && qLast.dispatchEvent(new InputEvent('input')) && false"
    - "q('input#cluster_reference_hostname').value == '${s[1].ContainerIP}' && 'cluster-hostname'"
    - "(q('input[formcontrolname=username]').value == '' || qLast.value == 'Administrator') && (qLast.value = '${s[1].CBUser}') && qLast.dispatchEvent && qLast.dispatchEvent(new InputEvent('input')) && false"
    - "q('input[formcontrolname=username]').value == '${s[1].CBUser}' && 'cluster-username'"
    - "q('input[formcontrolname=password]').value == '' && (qLast.value = '${s[1].CBPswd}') && qLast.dispatchEvent && qLast.dispatchEvent(new InputEvent('input')) && false"
    - "q('input[formcontrolname=password]').value == '${s[1].CBPswd}' && 'cluster-password'"
    - "q('.modal-dialog .panel-header h2').innerText == 'Add Remote Cluster' && (document.body.scrollTop = 0) && false"
  content: |
   In the
   <img src="./img/db-purple.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>
   <code>west</code> cluster...
   <br/><br/>

   <div class="check-xdcr-nav">
    In the main menu, click on <b>XDCR</b> (for cross-datacenter replication).
    <br/><br/>
   </div>
   <style>
     article.checked-w-cluster-xdcr .check-xdcr-nav { display: none; }
   </style>

   On the <b>XDCR&nbsp;Replications</b> screen...
   <br/><br/>

   Click on <b>ADD&nbsp;REMOTE</b> and fill in...
   <br/>

   <ul>
   <li>
    <b>Cluster&nbsp;Name</b>:
    <span class="check-cluster-name"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-cluster-name .check-cluster-name {
        visibility: visible !important;
      }
    </style>
    <br/>
    <code>east</code>
    <br/><br/>
   </li>
   <li>
    <b>IP/Hostname</b>:
    <span class="check-cluster-hostname"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-cluster-hostname .check-cluster-hostname {
        visibility: visible !important;
      }
    </style>
    <br/>
    <small><pre style="margin: 3px 0; padding: 0;">${s[1].ContainerIP}</pre></small>
    </br>
   </li>
   <li>
    <b>Username&nbspfor Remote&nbsp;Cluster</b>:
    <span class="check-cluster-username"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-cluster-username .check-cluster-username {
        visibility: visible !important;
      }
    </style>
    <small><pre style="margin: 3px 0; padding: 0;">${s[1].CBUser}</pre></small>
    </br>
   </li>
   <li>
    <b>Password</b>:
    <span class="check-cluster-password"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-cluster-password .check-cluster-password {
        visibility: visible !important;
      }
    </style>
    <br/>
    <small><pre style="margin: 3px 0; padding: 0;">${s[1].CBPswd}</pre></small>
   </li>
   </ul>

   Click the <b>Save</b> button.
 -
  title: Add a replication stream
  panel: w-cluster
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=replications]"
   styles: |
    body[data-h1=XDCRAddReplication] form.forms .width-10 .formrow.row {
      border: 2px solid red;
      padding: 2px;
    }
   checks:
    - "document.body.setAttribute('data-h1', q('header > h1 > span:last-child').innerText.trim().replaceAll(' ', '')) && false"
    - "(q('select[formcontrolname=fromBucket]').value || '').indexOf('beer-sample') >= 0 && 'rep-fromBucket'"
    - "q('input#replication_to_bucket').value == 'my-first-bucket' && 'rep-toBucket'"
    - "(q('select[formcontrolname=toCluster]').value || '').indexOf('east') >= 0 && 'rep-toCluster'"
  content: |
   Continuing in the
   <img src="./img/db-purple.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>
   <code>west</code> cluster...
   <br/><br/>

   On the <b>XDCR&nbsp;Replications</b> screen...
   <br/><br/>

   Click on <b>ADD&nbsp;REPLICATION</b> and fill in...
   <br/>

   <ul>
   <li>
    <b>Replicate&nbsp;From&nbsp;Bucket</b>:<br/>
    <code>beer-sample</code>
    <span class="check-rep-fromBucket"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-rep-fromBucket .check-rep-fromBucket {
        visibility: visible !important;
      }
    </style>
    <br/><br/>
   </li>
   <li>
    <b>Remote&nbsp;Bucket</b>:<br/>
    <code class="nowrap">my-first-bucket</code>
    <span class="check-rep-toBucket"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-rep-toBucket .check-rep-toBucket {
        visibility: visible !important;
      }
    </style>
    <br/><br/>
   </li>
   <li>
    <b>Remote&nbsp;Cluster</b>:
    <code>east</code>
    <span class="check-rep-toCluster"
          style="visibility: hidden; color: green;">&check;</span>
    <style>
      article.checked-w-cluster-rep-toCluster .check-rep-toCluster {
        visibility: visible !important;
      }
    </style>
    <br/>
   </li>
   </ul>

   Click <b>Save&nbsp;Replication</b>.
 -
  title: Congratulations
  panel: e-cluster
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   Going back to the
   <img src="./img/db-green.svg" style="height: 0.7rem; possition: relative; top: 1px;"/>
   <code>east</code> cluster,
   we can now see data appearing in the
   <code class="nowrap">my-first-bucket</code> bucket.
   <br/><br/>

   <b>Congratulations!</b>
   <br/><br/>

   You've created an ongoing data stream from
   the <code>west</code> cluster
   to
   the <code>east</code> cluster.
   <br/><br/>

   Besides the web-admin UI,
   you can also use Couchbase's <i>command-line tools</i>
   or <i>REST API's</i>
   to set up the same data streams.

   <style>
     body .container main.step-congratulations .right .diagram-area .west-east-stream {
       display: block !important;
       opacity: 1;
     }
   </style>
 -
  title: Learn More
  panel: none
  content: |
   Distributed <b>data stream</b> topologies
   for your enterprise applications are straightforwards
   and flexible with Couchbase.
   <br/><br/>

   Multi-master (bi-directional) replication,
   data filtering rules,
   mobile sync, and more are supported.
   <br/><br/>

   Learn more:
   <a href="https://docs.couchbase.com/server/current/learn/clusters-and-availability/xdcr-overview.html"
      target="_blank">
     Cross-datacenter Replication (XDCR) Documentation
   </a>
   <br/><br/>

   There's a lot more that Couchbase can do
   to help you build modern, distributed
   applications that can be deployed with agility
   across multiple locations and clouds.
   <br/><br/>

   Take a look:
   <a href="https://docs.couchbase.com/home/index.html"
      target="_blank">
     Couchbase&nbsp;Documentation
   </a>

   <style>
     body .container main.step-learn-more .right .diagram-area {
       min-height: 200px;
     }
     body .container main.step-learn-more .right .diagram-area .diagram-more {
       display: block !important;
       opacity: 1;
     }
   </style>
