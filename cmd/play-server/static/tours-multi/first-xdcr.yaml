containers: 2

panels:
 -
  id: w-database
  title: west database
  title-more: "username: ${s[0].CBUser} &nbsp;&nbsp; password: ${s[0].CBPswd}"
  color: "#8762a0;"
  iframe-src: http://${document.location.hostname}:${s[0].ContainerPortBase}/ui/index.html?lu=${s[0].CBUser}&lp=${s[0].CBPswd}
 -
  id: e-database
  title: east database
  title-more: "username: ${s[1].CBUser} &nbsp;&nbsp; password: ${s[1].CBPswd}"
  color: "#87d642"
  iframe-src: http://${document.location.hostname}:${s[1].ContainerPortBase}/ui/index.html?lu=${s[1].CBUser}&lp=${s[1].CBPswd}

diagram:
 height: 55px
 content: |
  <div class="diagram-more"
       style="position: absolute; display: none; opacity: 0.3;">
    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 60px; transform: rotateZ(50deg);"></div>
    <div style="position: absolute; top: 80px; left: 60px;">
      <img src="./img/db-purple.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">warehouse-w01</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 80px; transform: rotateZ(75deg);"></div>
    <div style="position: absolute; top: 110px; left: 40px;">
      <img src="./img/db-purple.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-w02</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 105px; transform: rotateZ(88deg);"></div>
    <div style="position: absolute; top: 140px; left: 20px;">
      <img src="./img/db-purple.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">vehicle-17</div>
    </div>
  </div>

  <div class="diagram-more"
       style="position: absolute; display: none; opacity: 0.3; left: 250px;">
    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 60px; transform: rotateZ(50deg);"></div>
    <div style="position: absolute; top: 80px; left: 60px;">
      <img src="./img/db-green.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">port-e01</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 80px; transform: rotateZ(75deg);"></div>
    <div style="position: absolute; top: 110px; left: 40px;">
      <img src="./img/db-green.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-e09</div>
    </div>

    <div style="position: absolute; top: 30px; left: 25px; border-top: 2px solid #777; transform-origin: top left; width: 105px; transform: rotateZ(88deg);"></div>
    <div style="position: absolute; top: 140px; left: 20px;">
      <img src="./img/db-green.svg"
           style="position: absolute; top: 0px; left: 0px; width: 20px;"/>
      <div style="position: absolute; top: 0px; left: 25px" class="small">store-e15</div>
    </div>
  </div>

  <div class="diagram-more west-east-stream"
       style="display: none; position: absolute; top: 27px; left: 205px; height: 4px; width: 44px;"></div>

  <style>
    .west-east-stream {
      background: linear-gradient(-90deg, #999, white);
      background-repeat: repeat-x;
      background-size: 15px 4px;
      animation: west-east-stream 4s infinite linear;
    }
    @keyframes west-east-stream {
      0% {
        background-position: 0px 0px;
      }
      100% {
        background-position: 44px 0px;
      }
    }
  </style>

  <label for="w-database"
         class="title background-color-white"
         style="top: 10px; width: 12em; height: 35px;">
    <img src="./img/db-purple.svg"
         style="top: 0px; left: 0px; width: 50px;"/>
    <div style="top: 3px; left: 50px;">
      west database
      <div class="small">${s[0].ContainerIP}</div>
    </div>
  </label>

  <label for="e-database"
         class="title background-color-white"
         style="top: 10px; left: 250px; width: 12em; height: 35px;">
    <img src="./img/db-green.svg"
         style="top: 0px; left: 0px; width: 50px;"/>
    <div style="top: 3px; left: 50px;">
      east database
      <div class="small">${s[1].ContainerIP}</div>
    </div>
  </label>

steps:
 -
  title: Welcome
  content: |
   Mission-critical enterprise applications
   are often distributed across
   <span class="nowrap">multiple locations</span>
   and clouds and are connected
   by <b>data&nbsp;streams</b>.
   <br/><br/>

   <style>
     body .container main.step-0 .right .diagram-area {
       min-height: 200px;
     }
     body .container main.step-0 .right .diagram-area .diagram-more {
       display: block !important;
     }
   </style>

   In this tour, we'll create a data stream
   between two Couchbase databases:
   <br/>
   <ul>
    <li>a <img src="./img/db-purple.svg" style="height: 1rem;"/>
        west database<br/></li>
    <li>a <img src="./img/db-green.svg" style="height: 1rem;"/>
        east database<br/></li>
   </ul>

   The <code>west</code> database will be
   the source of our data stream.
   <br/><br/>

   The <code>east</code> database will
   be the destination of our data stream.
 -
  title: The databases
  content: |
   The <code>west</code> database is running on server
   <code>${s[0].ContainerIP}</code>
   <br/><br/>

   The <code>east</code> database is running on server
   <code>${s[1].ContainerIP}</code>
   <br/><br/>

   <b>Click</b> on their diagram icons
   to open their web-admin UI's.
 -
  title: A new bucket in the east
  panel: e-database
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   Let's start by creating a new, empty bucket
   in the <code>east</code> database.
   <br/><br/>

   In the <code>east</code> web-admin UI...
   <br/><br/>

   Click on <i>ADD&nbsp;BUCKET</i>.
   <br/><br/>

   In the <b>Add&nbsp;Data&nbsp;Bucket</b> dialog box that appears...
   <br/><br/>

   For the <i>Name</i> field, type
   in a new bucket name,
   such as
   <code class="nowrap">"my-first-bucket"</code>.
   <br/><br/>

   Then, press the <i>Add&nbsp;Bucket</i> button.
 -
  title: Buckets in the east
  panel: e-database
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   You should now see three buckets in the
   <code>east</code> database:
   <br/>

   <ul>
    <li><code>beer-sample</code></li>
    <li><code>my-first-bucket</code></li>
    <li><code>travel-sample</code></li>
   </ul>

   You can see that your new
   <code class="nowrap">my-first-bucket</code>
   is <b>empty</b> with 0 items.
   <br/><br/>

   Next, let's examine the <code>west</code> database.
 -
  title: Buckets in the west
  panel: w-database
  panel-tell:
    clicks:
     - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   In the <code>west</code> database,
   there are only two buckets:
   <br/>

   <ul>
    <li><code>beer-sample</code></li>
    <li><code>travel-sample</code></li>
   </ul>

   Next, we are going to replicate data from the
   west's <code class"nowrap">beer-sample</code>
   bucket over into the east's
   <code class="nowrap">my-first-bucket</code>
   that you had previously created.
 -
  title: Add a remote server
  panel: w-database
  panel-tell:
    clicks:
     - "nav.nav-sidebar a[mn-tab=replications]"
  content:
    A data replication stream between Couchbase databases is called
    <i>XDCR</i>, or cross-datacenter replication.
    <br/><br/>

    In the <code>west</code> database,
    on the <i>XDCR&nbsp;Replications</i> screen...
    <br/><br/>

    Click on <i>ADD&nbsp;REMOTE</i>.
    <br/><br/>

    In the <b>Add Remote Cluster</b> dialog box that appears...
    <br/><br/>

    Enter a <i>Cluster&nbsp;Name</i>, like <code>"east"</code>.
    <br/><br/>

    Enter the <i>IP/Hostname</i> of the <code>east</code> database,
    which is <small>${s[1].ContainerIP}</small>
    <br/><br/>

    Enter the <i>Username</i> of the <code>east</code> database,
    which is <small>${s[1].CBUser}</small>
    <br/><br/>

    Enter the <i>Password</i> of the <code>east</code> database,
    which is <small>${s[1].CBPswd}</small>
    <br/><br/>

    Then, click the <i>Save</i> button.
 -
  title: Add a replication
  panel: w-database
  panel-tell:
    clicks:
     - "nav.nav-sidebar a[mn-tab=replications]"
  content:
    Continuing in the <code>west</code> database...
    <br/><br/>

    On the <i>XDCR&nbsp;Replications</i> screen...
    <br/><br/>

    Click on <i>ADD&nbsp;REPLICATION</i> to add an
    outgoing replication.
    <br/><br/>

    In the dialog screen that appears...
    <br/><br/>

    For the <i>Replicate&nbsp;From&nbsp;Bucket</i>
    dropdown, choose the data source bucket of
    <code>beer-sample</code>.
    <br/><br/>

    For the <i>Remote&nbsp;Bucket</i> field, enter
    <code class="nowrap">"my-first-bucket"</code>
    <br/><br/>

    For the <i>Remote&nbsp;Cluster</i> dropdown,
    choose the <code>east</code> cluster.
    <br/><br/>

    Finally, click <i>Save&nbsp;Replication</i>.
 -
  title: Congratulations
  panel: e-database
  panel-tell:
   clicks:
    - "nav.nav-sidebar a[mn-tab=buckets]"
  content: |
   Going back to the <code>east</code> database,
   we can now see data appearing in the
   <code class="nowrap">my-first-bucket</code> bucket.
   <br/><br/>

   <b>Congratulations!</b>
   <br/><br/>

   You've created an ongoing data stream from a bucket
   in the <code>west</code> database to a bucket
   in the <code>east</code> database.

   <style>
     body .container main.step-congratulations .right .diagram-area .west-east-stream {
       display: block !important;
       opacity: 1;
     }
   </style>
 -
  title: Next Steps
  content: |
   The same approach, whether through the web-admin UI or through
   Couchbase's API's, can be used to setup a distributed topology of
   data flows between remote databases.
   <br/><br/>

   <style>
     body .container main.step-next-steps .right .diagram-area {
       min-height: 200px;
     }
     body .container main.step-next-steps .right .diagram-area .diagram-more {
       display: block !important;
       opacity: 1;
     }
   </style>

   There's a lot more that Couchbase can do
   to help you build modern, distributed enterprise
   database applications.
   <br/><br/>

   Some good next tutorials to look at next: foo, bar, baz
   <br/><br/>

   And, you can try this setup and code
   and on your own computer by downloading Couchbase,
   or by using a free cloud trial account.
   <br/><br/>

   <style>
     body .container main.step-next-steps .right .diagram-area .west-east-stream {
       display: block !important;
       opacity: 1;
     }
   </style>
