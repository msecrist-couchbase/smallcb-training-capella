<!doctype html>
<html>
<head>
  <title>Couchbase API / SDK Playground</title>
  <link rel="stylesheet" type="text/css" href="/static/style.css">
  <style>
    .session-info {
      margin: 20px 30px 20px 30px;
      border-bottom: 1px solid #666;
      padding-bottom: 20px;
    }
    .session-info h2 {
      font-weight: bold;
      color: #464;
    }
    .session-info h2 em {
      font-weight: normal;
    }
    .session-info div {
      margin-bottom: 10px;
      margin-left: 20px;
    }
    .session-info div.connection {
      margin: 0 0 20px 20px;
      padding: 0 0 0 0;
      white-space: pre;
      font-size: 9pt;
      font-family: monospace;
    }
    .session-info div.connection a,
    .session-info div.connection b {
      font-size: 9pt;
      font-family: monospace;
      font-weight: bold;
    }
    .main .main-left {
      flex-basis: 15rem;
      flex-grow: 1;
      margin-right: 20px;
    }
    .main .main-left ul.examples {
      margin-right: 15px;
      padding-left: 20px;
    }
    .main .main-left ul.examples li {
      list-style: none;
      margin: 0 0 15px 0;
      border: 1px solid #888;
    }
    .main .main-left ul.examples li:hover {
      background-color: #c4d4d8;
    }
    .main .main-left ul.examples li.current {
      list-style: square;
      color: #73a1a4;
      background-color: #84d4d8;
    }
    .main .main-left ul.examples li a {
      display: block;
      padding: 5px 5px 5px 5px;
      text-decoration: none;
    }
    .main .main-left ul.examples li.session {
      margin-top: 45px;
      border: 2px solid #888;
    }
    .main .main-left ul.examples li.session a.session {
      font-weight: bold;
      font-size: 13px;
      color: #666;
      cursor: pointer;
    }
    .main .main-left ul.examples li.session a.session:hover {
      background-color: #9e9;
    }
    .main .main-center {
      flex-basis: 10rem;
      flex-grow: 100;
      margin-right: 10px;
    }
    .main .main-center textarea.code {
      display: none;
    }
    .main .main-center div.code-ace {
      margin-bottom: 15px;
      margin-right: 10px;
      width: 95%;
      height: 60vh;
    }
    .main .main-center input.run {
      border: 2px solid #888;
      padding: 5px 40px 5px 40px;
      background-color: #9c9;
      font-weight: bold;
      color: #666;
      cursor: pointer;
    }
    .main .main-center input.run:hover {
      background-color: #9e9;
      color: #666;
    }
    .main .main-center input.run.waiting,
    .main .main-center input.run.waiting:hover {
      background-color: orange;
      cursor: wait;
    }
    .main .main-output {
      flex-basis: 10rem;
      flex-grow: 100;
    }
    .main .main-output iframe.output {
      width: 95%;
      height: 60vh;
      border: 1px solid #888;
      margin-bottom: 40px;
    }

    .sticky {
      position: sticky;
      top: 0;
    }

    .display-none {
      display: none;
    }
    .hidden {
      visibility: hidden;
    }

    /* TODO: Re-enable lang-go once we figure out couchbase golang SDK v2. */
    .lang-go {
      display: none;
    }

    {{if not .Session}}
    .needs-session {
      display: none;
    }
    {{end}}
  </style>
  <script src="/static/ace/src-min/ace.js"></script>
  <script>
    function onRunSubmit() {
      document.getElementById("code").value = codeAce.getSession().getValue();
      document.getElementById("output").contentDocument.body.innerHTML = "running...";
      document.getElementById("main-output").className = "main-output";

      function checkDone() {
        var b = document.getElementById('run');

        b.disabled = true;
        b.className = "run waiting";

        var o = document.getElementById('output');

        var odoc = o.contentDocument || o.contentWindow.document;
        if (odoc.readyState == "complete" &&
            odoc.contentType == "text/plain") {
          b.disabled = false;
          b.className = "run";

          return;
        }

        setTimeout(checkDone, 500);
      }

      setTimeout(checkDone, 50);
    }
  </script>
</head>
<body>
  <div class="header flex-row">
    <div class="header-title">
      <a href="/{{if .Session}}?s={{.Session.SessionId}}{{end}}">
        <h1>Couchbase API / SDK Playground</h1></a>
    </div>

    <div class="header-links">
      {{if .Session}}
        <a href="/session-exit?s={{.Session.SessionId}}"
           class="session session-exit">stop test-drive</a>
      {{else}}
        <a href="/session"
           class="session">start a test-drive</a>
      {{end}}
      <a href="https://docs.couchbase.com">docs</a>
      <a href="https://www.couchbase.com">couchbase.com</a>
    </div>
  </div>

  {{if .Msg}}
    <div class="msg">{{.Msg}}</div>
  {{end}}

  {{if .Session}}
    <div class="session-info">
      <h2>Couchbase Server Test-Drive Session &mdash; for <em>{{.Session.FullName}}</em></h2>
      <div>
        Your test-drive session is active until there's ~{{.SessionsMaxAge}} of inactivity.
      </div>
      <div>
        To test-drive your Couchbase Server
        over the internet (NOTE: not encrypted, not for production!)...
      </div>
      <div class="connection">
  <b>Couchbase Server</b>
    <a href="http://{{.Host}}:8091">Web-Admin UI</a> : <a href="http://{{.Host}}:8091">http://{{.Host}}:8091</a> -- username: <em>{{.Session.CBUser}}</em> password: <em>{{.Session.CBPswd}}</em>

                   <a href="http://{{.Host}}:8091/ui/index.html#!/query/workbench">Query Workbench</a> | <a href="http://{{.Host}}:8091/ui/index.html#!/documents/editor">Document Editor</a> | <a href="http://{{.Host}}:8091/ui/index.html#!/documents/import">Import Documents</a> | REST API: http://{{.Session.CBUser}}:{{.Session.CBPswd}}@{{.Host}}:8091

  <b>Couchbase SDK's</b>             : connection snippets
    Java   <a href="https://docs.couchbase.com/java-sdk/current/hello-world/start-using-sdk.html">SDK docs</a>, <a href="https://docs.couchbase.com/sdk-api/couchbase-java-client/">API docs</a> : - Cluster.connect("couchbase://{{.Host}}", "{{.Session.CBUser}}", "{{.Session.CBPswd}}")
    NodeJS <a href="https://docs.couchbase.com/nodejs-sdk/current/hello-world/start-using-sdk.html">SDK docs</a>, <a href="https://docs.couchbase.com/sdk-api/couchbase-node-client/">API docs</a> : - new couchbase.Cluster("couchbase://{{.Host}}", {username: "{{.Session.CBUser}}", password: "{{.Session.CBPswd}}"})
    Python <a href="https://docs.couchbase.com/python-sdk/current/hello-world/start-using-sdk.html">SDK docs</a>, <a href="https://docs.couchbase.com/sdk-api/couchbase-python-client/">API docs</a> : - Cluster('couchbase://{{.Host}}', ClusterOptions(PasswordAuthenticator('{{.Session.CBUser}}', '{{.Session.CBPswd}}')))
      </div>

      <div>
        The following online examples will also run
        against your test-drive instance...
      </div>
    </div>
  {{end}}

  <div class="main flex-row">
    <div class="main-left">
      <h2>Examples</h2>

      <ul class="examples">
      {{range $i, $v := .Examples}}
        <li class="{{.className}} lang-{{.lang}} {{if eq .name $.Name}}current{{end}}">
          <a href="/{{$.ExamplesPath}}/{{.name}}{{if $.Session}}?s={{$.Session.SessionId}}{{end}}{{if gt $i 5}}#ex-{{.name}}{{end}}"
             id="ex-{{.name}}">
            {{.title}}
          </a>
        </li>
      {{end}}

      {{if not .Session}}
        <li class="session">
          <a href="/session"
             class="session">start a test-drive</a>
        </li>
      {{end}}
      </ul>
    </div>

    <div class="main-center">
      <div class="sticky">
      {{if or .Name .Lang .Code}}
        <h2>
          {{if .Title}}{{.Title}}{{else}}API / SDK Playground{{end}}
        </h2>

        <div>
          {{if .InfoBefore}}
            <div class="info infoBefore">{{.InfoBefore}}</div>
          {{end}}

          <form action="/run" method="post" target="output">
            {{if .Session}}
              <input name="s"
                     type="hidden" value="{{.Session.SessionId}}"/>
            {{end}}

            <input name="lang"
                   type="hidden" value="{{.Lang}}"/>

	    <div id="code-ace" class="code-ace"></div>

            <textarea id="code"
                      name="code"
                      class="code"
                      wrap="off"
                      autocorrect="off"
                      autocomplete="off"
                      autocapitalize="off"
                      spellcheck="false">{{.Code}}</textarea>

            <input type="submit" value="run" class="run" id="run"
                   onclick="return onRunSubmit()"/>
          </form>

          {{if .InfoAfter}}
            <div class="info infoAfter">{{.InfoAfter}}</div>
          {{end}}
        </div>
      {{else}}
        <div style="margin-top: .8rem;">
          Please select an example{{if not .Session}}... or <a href="/session" class="nowrap">start a test-drive</a>&nbsp;session{{end}}.
        </div>
      {{end}}
      </div>
    </div>

    <div class="main-output hidden" id="main-output">
      <div class="sticky">
      {{if or .Name .Lang .Code}}
        <h2>Output</h2>

        <iframe name="output" id="output" class="output"></iframe>
      {{end}}
      </div>
    </div>
  </div>

  <div class="footer">
    powered by Couchbase Labs and Couchbase Server {{.Version}}
  </div>

  <script>
    var codeAce = ace.edit("code-ace");

    codeAce.getSession().setValue(document.getElementById("code").value);

    codeAce.setTheme("ace/theme/tomorrow_night");
  </script>
</body>
</html>
