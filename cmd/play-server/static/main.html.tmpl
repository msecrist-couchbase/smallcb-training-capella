<!doctype html>
<html>
<head>
  <title>Couchbase API / SDK Playground</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,600;1,300&Ubuntu+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/static/styles/site.css">
  <link rel="stylesheet" type="text/css" href="/static/styles/main.css">
  <style>
    /* TODO: Re-enable lang-go once we figure out couchbase golang SDK v2. */
    .lang-go {
      display: none;
    }

    {{if not .Session}}
    .needs-session {
      display: none;
    }
    {{end}}
  </style>
  <script src="/static/ace/src-min/ace.js"></script>
  <script>
    function onRunSubmit() {
      document.getElementById("code").value = codeAce.getSession().getValue();
      document.getElementsByTagName("body")[0].style.color = "#fff";
      document.getElementById("output").contentDocument.body.innerHTML = 
        "<span style='color:white'>running...</span>";
      document.getElementById("code-output").className = "code-output";
      return true;
    }
  </script>
  {{.AnalyticsHTML}}
</head>
<body class="dark">
  <header>
    <div class="logo">
      <a href="/{{if .Session}}?s={{.Session.SessionId}}{{end}}">
        <h1>Couchbase API / SDK Playground</h1>
      </a>
    </div>
    <nav>
      <ul>
        <li>
          {{if .Session}}
          <a href="/session-exit?s={{.Session.SessionId}}" class="session">
            stop test-drive
          </a>
          {{else}}
          <a href="/session">
            start test-drive
          </a>
          {{end}}
        </li>
        <li>
          <a href="https://docs.couchbase.com">docs</a>
        </li>
        <li>
          <a href="https://www.couchbase.com">couchbase.com</a>
        </li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="info-panel" id="infoPanel">
      {{if .Msg}}
      <div class="message-info">{{.Msg}}</div>
      {{end}}

      {{if .Session}}
      <div class="session-info">
        <h2>Couchbase Server Test-Drive Session &mdash; for <em>{{.Session.FullName}}</em></h2>
        <div>
          Your test-drive session is active until there's ~{{.SessionsMaxAge}} of inactivity.
        </div>
        <div>
          To test-drive your Couchbase Server
          over the internet (NOTE: not encrypted, not for production!)...
        </div>
        <div class="connection">
      <b>Couchbase Server</b>
        <a href="http://{{.Host}}:8091" class="ui">Web-Admin UI<img src="/static/shots/shot-dashboard.png"/></a> : <a href="http://{{.Host}}:8091/ui/index.html#!/query/workbench" class="ui"><img src="/static/shots/shot-query-workbench.png"/>Query Workbench</a> | <a href="http://{{.Host}}:8091/ui/index.html#!/documents/editor" class="ui"><img src="/static/shots/shot-documents.png"/>Document Editor</a> | <a href="http://{{.Host}}:8091/ui/index.html#!/documents/import" class="ui"><img src="/static/shots/shot-import-documents.png"/>Import Documents</a> | REST API: http://{{.Session.CBUser}}:{{.Session.CBPswd}}@{{.Host}}:8091


      <b>Couchbase SDK's</b>             : connection snippets
        Java   <a href="https://docs.couchbase.com/java-sdk/current/hello-world/start-using-sdk.html">SDK docs</a>, <a href="https://docs.couchbase.com/sdk-api/couchbase-java-client/">API docs</a> : - Cluster.connect("couchbase://{{.Host}}", "{{.Session.CBUser}}", "{{.Session.CBPswd}}")
        NodeJS <a href="https://docs.couchbase.com/nodejs-sdk/current/hello-world/start-using-sdk.html">SDK docs</a>, <a href="https://docs.couchbase.com/sdk-api/couchbase-node-client/">API docs</a> : - new couchbase.Cluster("couchbase://{{.Host}}", {username: "{{.Session.CBUser}}", password: "{{.Session.CBPswd}}"})
        Python <a href="https://docs.couchbase.com/python-sdk/current/hello-world/start-using-sdk.html">SDK docs</a>, <a href="https://docs.couchbase.com/sdk-api/couchbase-python-client/">API docs</a> : - Cluster('couchbase://{{.Host}}', ClusterOptions(PasswordAuthenticator('{{.Session.CBUser}}', '{{.Session.CBPswd}}')))
        </div>

        <div>
          The following online examples will also run
          against your test-drive instance...
        </div>
      </div>
      {{end}}
    </div>
    <div class="workspace">
      {{if .Session}}
      <div class="workspace-header">
        
        <div class="header-left">
          <a onClick="toggleInfoPanel();">Toggle Info</a>
        </div>
        <div class="header-right">
          <span class="head-server">cb server:</span> <code>http://{{.Host}}:8091</code>
          <span class="head-user">username:</span> <code>{{.Session.CBUser}} </code>
          <span class="head-pass">password:</span> <code>{{.Session.CBPswd}}</code>
        </div>
        
      </div>
      {{end}}
      <div class="workspace-body">
        <div class="code-examples">
          <h2>Examples</h2>
          <div class="div-hr">
            <hr />
          </div>
          <ul class="examples">
            {{range $i, $v := .Examples}}
            <li class="{{.className}} lang-{{.lang}} {{if eq .name $.Name}}current{{end}}">
              <a href="/{{$.ExamplesPath}}/{{.name}}{{if $.Session}}?s={{$.Session.SessionId}}{{end}}{{if gt $i 5}}#ex-{{.name}}{{end}}"
                id="ex-{{.name}}">
                {{.title}}
              </a>
            </li>
            {{end}}

            {{if not .Session}}
            <li class="session">
              <a href="/session"
                class="session">Start Test-drive</a>
            </li>
            {{end}}
          </ul>
        </div>

        <div class="code-editor">
          <div class="sticky">
            {{if or .Name .Lang .Code}}
            <h2>
              {{if .Title}}{{.Title}}{{else}}API / SDK Playground{{end}}
            </h2>

            <div>
              {{if .InfoBefore}}
              <div class="info infoBefore">{{.InfoBefore}}</div>
              {{end}}

              <form action="/run" method="post" target="output">
                {{if .Session}}
                <input name="s" type="hidden" value="{{.Session.SessionId}}"/>
                {{end}}
                <input name="lang" type="hidden" value="{{.Lang}}"/>

                <div id="code-ace" class="code-ace"></div>

                <textarea id="code" name="code" class="code" wrap="off" autocorrect="off" 
                  autocomplete="off" autocapitalize="off"
                  spellcheck="false"
                >{{.Code}}</textarea>

                <input type="submit" value="run" class="run" id="run"
                  onclick="return onRunSubmit()" />
              </form>

              {{if .InfoAfter}}
              <div class="info infoAfter">{{.InfoAfter}}</div>
              {{end}}
            </div>
            {{else}}
            <div>
              Please select an example{{if not .Session}}... or <a href="/session" class="nowrap">start a test-drive</a>&nbsp;session{{end}}.
            </div>
            {{end}}
          </div>
        </div>

        <div class="code-output hidden" id="code-output">
          <div class="sticky">
            {{if or .Name .Lang .Code}}
            <h2>Output</h2>
            <iframe name="output" id="output" class="output"></iframe>
            {{end}}
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div>Â© 2020 Couchbase Labs</div>
    <div>Couchbase Server {{.Version}}</div>
  </footer>
  <script src="/static/scripts/infoPanel.js"></script>
  <script>
    var codeAce = ace.edit("code-ace");
    codeAce.getSession().setValue(document.getElementById("code").value);
    codeAce.setTheme("ace/theme/nord_dark");
    codeAce.setOption("useWorker", false); // No syntax checking.

    {{if .LangAce}}
    codeAce.setOption("mode", "ace/mode/{{.LangAce}}");
    {{end}}
  </script>
</body>
</html>
