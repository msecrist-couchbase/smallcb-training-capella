title: Sub-document Mutate
page: page-04
lang: py
code: |
  #!/usr/bin/python3
  import sys
  import couchbase.collection
  import couchbase.subdocument as SD
  from couchbase.cluster import Cluster, ClusterOptions
  from couchbase_core.cluster import PasswordAuthenticator
  from couchbase.durability import ServerDurability, Durability
  from datetime import timedelta

  pa = PasswordAuthenticator('{{.CBUser}}', '{{.CBPswd}}')
  cluster = Cluster('couchbase://{{.Host}}', ClusterOptions(pa))
  bucket = cluster.bucket('travel-sample')
  collection = bucket.default_collection()
  try:
    document = dict(
      country="Iceland", callsign="ICEAIR", iata="FI", icao="ICE", 
      id=123, name="Icelandair", type="airline"
    )
    result = collection.upsert(
      'airline_123', 
      document, 
      expiry=timedelta(minutes=1),
      durability=ServerDurability(Durability.MAJORITY)
    )
    print("UPSERT SUCCESS")
    print("cas result: ", result.cas)
  except:
    print("exception:", sys.exc_info())
    
  try:
    result = collection.lookup_in('airline_123', [SD.get('name')])
    name = result.content_as[str](0) # "United Kingdom"
    print("name: ", name)

  except:
    print("exception:", sys.exc_info()[0])
infoAfter: |
  Our Sub-document API allows for only retrieving or mutating a portion of 
  a larger document. For operations where you just need to update one field 
  in a document, this keeps you from having to query, change and send back an
  updated document and is more performant getting or setting in one operation. 
  Visit our docs to learn more about <a target="_blank" href="https://docs.couchbase.com/python-sdk/current/howtos/subdocument-operations.html#retrieving">Retrieving Sub-documents in Python</a>.